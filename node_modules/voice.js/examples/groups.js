var voicejs = require('../voice.js');

var fs = require('fs');

var client = new voicejs.Client({
	tokens: require('./tokens.json')
});

var group = process.argv[2] || 'Ninjas';
var groups = {};

// Download all contacts and display them.
client.contacts('getGroups', function(error, response, data){
	if(error){
		return console.log(error)
	}
	for(var id in data.settings.groups){
		if(id.length > 2){
			groups[id] = data.settings.groups[id];
			groups[id].contacts = {};
		}
	}
	console.log("Added matching groups\n");
	console.log(groups);

//	console.log(data.settings);
//	console.log(data.settings.groups);

	client.contacts('get', function(error, response, cdata){
		if(error){
			return console.log(error)
		}
		console.log(cdata.contacts);
		for(var id in cdata.contacts){
			console.log("Name: " + cdata.contacts[id].name);
			client.contacts('getSettings', {id: id}, function(error, response, sdata){
				if(error){
					return console.log('ERROR GETTING CONTACT SETTINGS: ', error);
				}
				console.log("Adding Contact: " + id);
				console.log(sdata);
				console.log("\n");
				sdata.contactData.groupIds.forEach(function(gid){
					console.log("GroupID: " + gid);
					console.log("GroupName: " + groups[gid].name);
					groups[gid].contacts[id] = cdata.contacts[id];
				}.bind(this, id));
				//console.log(groups);
				// if(sdata.contactData.groupIds.indexOf(gid) != -1){
				// 	console.log('\nGoogle Voice settings for contact with id', cid);
				// 	console.log('\n', cdata.contacts[cid].name, cdata.contacts[cid].emails.join(', ') );
				// 	cdata.contacts[cid].numbers.forEach(function(number){
				// 		console.log('    %s: %s', number.phoneType, number.displayNumber);
				// 	});
				// }
			});

		}
				//console.log(groups);
	});
	console.log(groups);return;
	// for(var gid in data.settings.groups){
	// 	if(data.settings.groups[gid].name == group){
	// 		console.log('\nText list for ' + group + ': ');
	// 	}
	// }

	// for(var id in data.contacts){
	// 	console.log('\n', data.contacts[id].name, data.contacts[id].emails.join(', ') );
	// 	data.contacts[id].numbers.forEach(function(number){
	// 		console.log('    %s: %s', number.phoneType, number.displayNumber);
	// 	});
	// };
});


// REMOVE THIS LINE TO MAKE CHANGES TO YOUR GV ACCOUNT AFTER YOU'VE REVIEWED THE CHANGES BELOW!
return;



